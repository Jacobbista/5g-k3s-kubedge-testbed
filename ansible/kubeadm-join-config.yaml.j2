{% raw %}
# ansible/kubeadm-join-config.yaml.j2
# ===============================================
# Template per la configurazione di join dei worker.
# Ansible sostituir√† le variabili {{ ... }} con i valori reali.
{% endraw %}

apiVersion: kubeadm.k8s.io/v1beta3
kind: JoinConfiguration
discovery:
  bootstrapToken:
    apiServerEndpoint: "{{ hostvars['k8s-master']['ansible_host'] }}:6443"
    token: "{{ hostvars['k8s-master']['join_token'] }}"
    caCertHashes:
      - "sha256:{{ hostvars['k8s-master']['join_hash'] }}"
nodeRegistration:
  criSocket: "unix:///var/run/containerd/containerd.sock"
  kubeletExtraArgs:
    # L'IP corretto di questo specifico worker
    node-ip: "{{ ansible_host }}"