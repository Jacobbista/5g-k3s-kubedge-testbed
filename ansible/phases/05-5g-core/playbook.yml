---
# PHASE 5: 5G CORE NETWORK FUNCTIONS
# Deploy Open5GS-based 5G Core after overlay network is ready

- name: "PHASE 5 | Create Namespaces"
  hosts: masters
  become: no
  tags:
    - phase5
    - namespaces
  tasks:
    - name: Ensure 5g namespace exists
      kubernetes.core.k8s:
        api_version: v1
        kind: Namespace
        name: 5g
        state: present
        definition:
          metadata:
            name: 5g
            labels:
              name: 5g-core
        kubeconfig: "/home/vagrant/kubeconfig"
      run_once: true

    - name: Ensure mec namespace exists
      kubernetes.core.k8s:
        api_version: v1
        kind: Namespace
        name: mec
        state: present
        definition:
          metadata:
            name: mec
            labels:
              name: mec-applications
        kubeconfig: "/home/vagrant/kubeconfig"
      run_once: true

- name: "PHASE 5 | Infrastructure Setup"
  hosts: masters,workers,edges
  become: yes
  tags:
    - phase5
    - infrastructure_setup
    - infra
  roles:
    - roles/infrastructure_setup
    - roles/runtime_watchdog

- name: "PHASE 5 | ConfigMaps Setup"
  hosts: masters
  become: yes
  tags:
    - phase5
    - configmaps_setup
    - configmaps
  roles:
    - roles/configmaps_setup

- name: "PHASE 5 | Deploy Network Functions"
  hosts: masters
  become: no
  tags:
    - phase5
    - nf_deployments
    - nfs
  roles:
    - roles/nf_deployments

- name: "PHASE 5 | Import Subscribers"
  hosts: masters
  become: no
  tags:
    - phase5
    - subscriber_import
    - subscribers
  roles:
    - roles/subscriber_import

- name: "PHASE 5 | Validate Deployment"
  hosts: masters
  become: no
  tags:
    - phase5
    - validation
  roles:
    - roles/validation
